# ビルドに関する注意点

## PyInstallerでの実行ファイル生成

### 改良済みビルド設定（2025年4月20日）
- `--collect-submodules=whisper`: Whisperの全サブモジュールを含める
- `--hidden-import`: 必要なライブラリを明示的に指定（scipy, numpy, ffmpeg, whisper）
- `--add-data`: Whisperのアセットファイルを明示的に含める

### アセットファイル問題
Whisperはモデル実行時に`*.npz`形式のフィルターファイルなど特定のアセットファイルが必要です。これらのファイルはPyInstallerでパッケージ化する際に特別な処理が必要になります：
- `mel_filters.npz`: メル周波数フィルタバンクの定義ファイル
- モデル重みファイル: modelsディレクトリに保存される各モデルの重みファイル

### 実行環境の違い
- 開発環境: Pythonインタプリタが直接実行し、サイトパッケージから必要なファイルを読み込む
- ビルド環境: パッケージ化された実行ファイルは一時ディレクトリに展開され、そこからアセットを探す

### ビルドプロセス
1. `python build.py`を実行
2. 実行ファイルが`dist`ディレクトリに生成される
3. `SimpleTranscriber.exe`が単一ファイルとして生成される

### 実行ファイルの配布
配布する実行ファイルはユーザーの初回実行時に以下の作業を行います：
1. モデルファイルの自動ダウンロード（インターネット接続が必要）
2. キャッシュディレクトリへのファイル保存
3. 必要に応じて出力ディレクトリの作成

### テスト前の確認事項
1. Python環境とPythonスクリプトが正常に動作するか
2. アセットファイルが正しく配置されているか
3. build.pyの出力で表示されるアセットファイル一覧を確認
4. 生成された実行ファイルのサイズと内容を確認

### 既知のビルド問題と対策
1. **アセットファイル参照エラー**
   - 解決策: `os.environ["WHISPER_ASSETS_PATH"]`の設定
   - 修正済みコード: `_setup_whisper_assets`メソッドでパスを適切に設定

2. **モジュール読み込みエラー**
   - 解決策: `--hidden-import`オプションで必要なモジュールを指定
   - 対象: scipy, numpy, ffmpeg, whisper

3. **クロスプラットフォームの問題**
   - 解決策: OSごとにパス区切り文字を適切に設定
   - Windows: セミコロン (;)
   - Linux/Mac: コロン (:)
