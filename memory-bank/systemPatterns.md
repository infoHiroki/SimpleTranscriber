# シンプル文字起こしツール システムパターン

## システムアーキテクチャ

### 全体構造
シンプル文字起こしツールは、単一のPythonファイル（`transcriber_app.py`）にMVCパターンの要素を組み込んだ構造を採用しています。

```
WhisperTranscriberApp (メインクラス)
├── モデル: ファイルパス、モデル選択、言語選択などの状態管理
├── ビュー: Tkinterを使用したGUIコンポーネント
└── コントローラ: ユーザーアクションに応じた処理ロジック（文字起こし開始、ファイル保存など）
```

### コンポーネント関係
- **GUIコンポーネント**: ユーザー入力を受け付け、結果を表示
- **Whisperトランスクライバー**: 音声/動画ファイルを文字に変換する核心部分
- **非同期処理マネージャー**: 長時間処理をバックグラウンドで実行し、進捗を報告

## デザインパターン

### シングルトンパターン
`WhisperTranscriberApp`クラスは事実上シングルトンとして機能し、アプリケーション全体の状態を管理します。

### 非同期処理パターン
```
メインスレッド（GUI）
    │
    ├── イベント処理・UI更新
    │
ワーカースレッド（文字起こし処理）
    │
    ├── モデル読み込み
    ├── 音声処理
    └── 結果生成
```

### コールバックパターン
進捗状況を報告するためのプログレスコールバック機能：
```python
def progress_callback(percent):
    self._update_status(f"文字起こし処理中... {percent}%", 10 + percent * 0.85)
```

## 重要な実装パス

### 1. アプリケーション初期化
```
__init__() → _create_widgets() → メインフレーム・各種UIコンポーネント作成
```

### 2. 文字起こし処理フロー
```
_start_transcription()      # UI操作の検証とスレッド起動
    ↓
_run_transcription()        # 別スレッドでの処理実行
    ↓
Whisperモデル初期化         # モデルサイズと言語に基づきトランスクライバーを初期化
    ↓
transcribe()メソッド呼び出し # 進捗コールバックを渡して文字起こし実行
    ↓
_update_result()           # 結果をGUIに表示
```

### 3. 結果保存フロー
```
_save_result() → ファイル選択ダイアログ → テキストファイル書き込み
```

## 技術的決定ポイント

### 1. モデル選択と言語設定
- 4つのモデルサイズオプション（tiny, base, small, medium）
- 3つの言語オプション（ja, en, auto）
- デフォルトは「tiny」モデルと「ja」（日本語）

### 2. 非同期処理の実装
- ThreadingモジュールによるUI応答性の維持
- 進捗状況のリアルタイム更新

### 3. 依存関係の自動インストール
- 初回実行時に必要なパッケージを自動的にインストール
- ユーザー体験を向上させるための配慮

### 4. エラーハンドリング
- try-exceptブロックを使用して広範なエラー処理
- ユーザーフレンドリーなエラーメッセージの表示

## データフロー

### 入力データフロー
```
ユーザー入力（ファイル選択、オプション選択）→ GUIコンポーネント → 内部変数（self.file_path, self.model, self.language）
```

### 処理データフロー
```
音声/動画ファイル → Whisperトランスクライバー → テキスト結果
```

### 出力データフロー
```
テキスト結果 → GUIテキストエリア表示 → （任意）テキストファイル保存
```

## 拡張性と保守性
- **モジュール性**: 主要な機能がメソッドとして分離されている
- **明確なインターフェース**: GUIと処理ロジックの分離
- **コメント**: 重要な部分にはコメントが付与されている
- **エラーハンドリング**: 適切なエラー捕捉と処理
